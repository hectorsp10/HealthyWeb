{% extends "layout.html" %}

{% block title %}
    Recipes
{% endblock %}

<!-- En la parte superior de la página, aparecerá un formulario donde el usuario tendrá la capacidad de introducir nuevas recetas. El formulario constará de los valores "nombre"
 , ingredientes (una barra de búsqueda donde aparezcan todos los ingredientes y el usuario irá añadiendo. Los ingredientes se irán acumulando en forma de tarjetas tipo botón)
 y un botón "crear" que ejecutará la creación de la nueva receta. -->

{% block main %}
<div class="container mt-5">
    <h2>Crear Receta</h2>
    <form id="recipeForm" action="/create_recipe" method="POST">
        <div class="form-group">
            <label for="recipeName">Nombre de la Receta</label>
            <input type="text" class="form-control" id="recipeName" name="recipe_name" required>
        </div>

        <div class="form-group">
            <label for="ingredient">Ingredient:</label>
            <select multiple class="form-control" id="ingredient" name="ingredient">
                <!-- Options will be populated here by JavaScript -->
            </select>
        </div>

        <div class="form-group">
            <label for="quantity">Quantity (grams):</label>
            <input type="number" class="form-control" id="quantity" placeholder="Enter quantity in grams">
        </div>

        <button type="button" class="btn btn-primary" id="addIngredient">Add Ingredient</button>

        <div class="form-group">
            <label>Ingredientes Seleccionados</label>
            <ul id="selectedIngredients" class="list-group"></ul>
        </div>

        <button type="submit" class="btn btn-primary">Create Recipe</button>

    </form>
</div>

<script>
    $(document).ready(function() {
        // Realizar una solicitud AJAX para obtener los ingredientes
        $.ajax({
            url: '/ingredients',
            method: 'GET',
            success: function(data) {
                var ingredientsSelect = $('#ingredients');
                // Añadir cada ingrediente como una opción en el select
                data.forEach(function(ingredient) {
                    ingredientsSelect.append(
                        $('<option>', { value: ingredient.id, text: ingredient.name })
                    );
                });
            }
        });

        $('#addIngredient').click(function(){
            var ingredientId = $('#ingredient').val();
            var ingredientName = $('#ingredient option:selected').text();
            var quantity = $('#quantity').val();

            if (quantity && ingredientId){
                $('#selectedIngredients').append(
                    '<div class="ingredient-quantity">' + '<label>' + ingredientName + ' (' + quantity + ' grams):</label>' +
                        '<input type="hidden" name="ingredient_id[]" value="' + ingredientId + '">' +
                        '<input type="hidden" name="quantity[]" value="' + quantity + '">' +
                    '</div>'
                );
                $('#quantity').val(''); // Clear the quantity input
            }
            else{
                alert("Please select an ingredient and enter a quantity.");
            }
        });

        // Manejar el envío del formulario
        $('#recipeForm').submit(function(event) {
            event.preventDefault();
                
            var formData = $(this).serialize();
                
            $.ajax({
                url: '/create_recipe',
                method: 'POST',
                data: formData,
                success: function(response) {
                    alert('Ingredients submitted successfully!');
                },
                error: function() {
                    alert('Error submitting ingredients.');
                }
            });
        });
    });
</script>
{% endblock %}